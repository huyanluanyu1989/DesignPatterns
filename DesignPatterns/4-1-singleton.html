<!DOCTYPE html>
<html>
<head>
	<title>singleton</title>
</head>
<body>
	<input type="button" name="btn" id="btn" value='惰性单例'>
<script type="text/javascript">
	//单例模式
	// var Singleton = function(name){
	// 	this.name = name;
	// 	this.instance = null;
	// }

	// Singleton.prototype.getName = function(){
	// 	console.log(this.name);
	// }


	// Singleton.getInstance = function(name){
	// 	if(!this.instance){
	// 		this.instance = new Singleton(name);
	// 	}
	// 	return this.instance;
	// }

	// var a = Singleton.getInstance('name1');
	// var b = Singleton.getInstance('name2');
	// console.log(a===b)

	var Singleton = function(name){
		this.name = name;
	}

	Singleton.prototype.getName = function(){
		console.log(this.name);
	}

	Singleton.getInstance = (function(){
		var instance = null;
		return function(name){
			if(!instance){
				instance = new Singleton(name);
			}
			return instance;
		}
	})();
	var a = Singleton.getInstance('name1');
	var b = Singleton.getInstance('name2');
	console.log(a===b);


	//透明的单例模式
	//单例类，在页面内创建唯一的div节点
	// var CreateDiv = (function(){
	// 	var instance;

	// 	var CreateDiv = function(html){
	// 		if(instance){
	// 			return instance;
	// 		}
	// 		this.html = html;
	// 		this.init();

	// 		return instance = this;
	// 	}
	// 	CreateDiv.prototype.init = function(){
	// 		var div = document.createElement('div');
	// 		div.innerHTML = this.html;
	// 		document.body.appendChild(div);
	// 	}
	// 	return CreateDiv;
	// })();

	// var a = new CreateDiv('div1');
	// var b = new CreateDiv('div2');
	// console.log(a,b)

	//代理实现单例模式
	// let CreateDiv = function(html){
	// 	this.html = html;
	// 	this.init();
	// }
	// CreateDiv.prototype.init = function(){
	// 	var div = document.createElement('div');
	// 	div.innerHTML = this.html;
	// 	document.body.appendChild(div);
	// }

	// let ProxySingletonCreateDiv = (()=>{
	// 	var instance;
	// 	return function( html ){
	// 		if(!instance){
	// 			instance = new CreateDiv( html);
	// 		}
	// 		return instance;
	// 	}
	// })();
	// var a = new ProxySingletonCreateDiv('div1');
	// var b = new ProxySingletonCreateDiv('div2');
	// console.log(a,b)
	// 
	/**
	 * JavaScript中的单例模式
	 */
	//动态创建命名空间
	// var myFun = {};
	// myFun.nameSpace = function(name){
	// 	var protoName = name.split('.');
	// 	var current = myFun;
	// 	for(var i  in protoName){
	// 		if(!current[protoName[i]]){
	// 			current[protoName[i]] = {};
	// 		}
	// 		current = current[protoName[i]];
	// 	}
	// }

	// myFun.nameSpace('event');
	// myFun.nameSpace('dom.style');
	// console.log(myFun)

	// var myFun = {
	// 	event:{},
	// 	dom:{
	// 		style:{}
	// 	}
	// }
	// console.log(myFun)
	// 
	
	//使用闭包封装私有变量
	// var user = (function(){
	// 	var _name = 'John';
	// 	var _old = '30';
	// 	return {
	// 		getUserInfo:function(){
	// 			return _name+'-'+_old;
	// 		}
	// 	}
	// })();
	// console.log(user.getUserInfo())


	//惰性单例
	// var createLoginLayer = function(){
	// 	var div;
	// 	return function(){
	// 		if(!div){
	// 			div = document.createElement('div')
	// 			div.innerHTML = '我是登录浮窗'
	// 			div.style.display = 'none'
	// 			document.body.appendChild(div)
	// 		}
	// 		return div
	// 	}
	// }()
	// document.getElementById('btn').onclick = function(){
	// 	var loginLayer = createLoginLayer()
	// 	loginLayer.style.display = 'block'
	// }

	//通用的惰性单例
	var getSingle = function(fn){
		let result
		return function(){
			return result || (result = fn.apply(this,arguments))
		}
	}

	var createDiv = function(){
		var div = document.createElement('div')
		div.innerHTML = '我是登录浮窗'
		div.style.display = 'none'
		document.body.appendChild(div)
		return div
	}

	var createSingleDiv = getSingle(createDiv)

	// document.getElementById('btn').onclick = function(){
	// 	console.log('div')
	// 	var div = createSingleDiv()
	// 	div.style.display = 'block'
	// }


	var createFrame = function(){
		var iframe = document.createElement('iframe')
		document.body.appendChild(iframe)
		return iframe
	}

	var createSingleIFrame = getSingle(createFrame)

	// document.getElementById('btn').onclick = function(){
	// 	var iframe = createSingleIFrame()
	// 	iframe.src = 'http://baidu.com'
	// }
	

	//绑定click单例
	var bindEvent = getSingle(function(){
		document.getElementById('btn').onclick = function(){
			console.log('click')
		}
		return true
	})

	var render = function(){
		console.log('开始渲染')
		bindEvent()
	}

	render()
	render()
	render()
</script>
</body>
</html>